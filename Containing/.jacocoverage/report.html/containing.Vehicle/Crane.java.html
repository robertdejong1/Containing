<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="nl"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>Crane.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JaCoCoverage analysis of project &quot;Containing&quot; (powered by JaCoCo from EclEmma)</a> &gt; <a href="index.html" class="el_package">containing.Vehicle</a> &gt; <span class="el_source">Crane.java</span></div><h1>Crane.java</h1><pre class="source lang-java linenums">/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */

package containing.Vehicle;

import containing.Command;
import containing.CommandHandler;
import containing.Container;
import containing.Exceptions.CargoOutOfBoundsException;
import containing.Exceptions.ContainerNotFoundException;
import containing.Exceptions.VehicleOverflowException;
import containing.Platform.Platform;
import containing.Road.Road;
import containing.Road.Route;
import containing.Vector3f;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;

/**
 *
 * @author Robert
 */
public abstract class Crane extends InternVehicle {
    
<span class="fc" id="L29">    protected int timeCountDown = 0;</span>
    protected final static int CAPICITY = 1;
    protected int counter;
<span class="fc" id="L32">    protected final float SECURETIME = 0.5f * 60;</span>
    
    //testvariables -&gt; for every crane and container different
<span class="fc" id="L35">    private final int liftTimeMin = 0 * 60;</span>
<span class="fc" id="L36">    private final float liftTimeMax = 3.5f * 60;</span>
<span class="fc" id="L37">    private final float dropTimeMin = 0 * 60;</span>
<span class="fc" id="L38">    private final float dropTimeMax = 3.5f * 60;</span>
<span class="fc" id="L39">    private final float moveContainerSpeed = 5; //meter per seconde</span>
<span class="fc" id="L40">    protected final int maxSpeedUnloaded = 4;</span>
<span class="fc" id="L41">    protected final int maxSpeedLoaded = 5;</span>
    
    private float loadTime;
    private float unloadTime;
    private float resetTime;
    
<span class="fc" id="L47">    private AGV agvToUnload = null;</span>
    
<span class="fc" id="L49">    boolean readyForNextContainer = true;</span>

<span class="fc" id="L51">    protected final int metersToNextAgvSpot = 10;</span>
    
    public float width;
    public float length;
    
    

    public Crane(Vector3f startPosition, Platform platform, Type type, float width, float length){
<span class="fc" id="L59">        super(CAPICITY, startPosition, platform, type);</span>
<span class="fc" id="L60">        this.width = width;</span>
<span class="fc" id="L61">        this.length = length;</span>
<span class="fc" id="L62">    }</span>
    
    public void unload(AGV agv) throws VehicleOverflowException, ContainerNotFoundException, CargoOutOfBoundsException{
        try
        {
<span class="nc" id="L67">            agv.load(super.unload());</span>
        }
<span class="nc" id="L69">        catch(Exception e){ throw e; }</span>
        //platform moet agv volgende route geven
<span class="nc" id="L71">    }</span>
    

    public void load(ExternVehicle ev, int column) throws Exception
    {
<span class="nc bnc" id="L76" title="All 2 branches missed.">        for (Integer row : ev.getUnloadOrderY(column))</span>
        {
<span class="nc bnc" id="L78" title="All 2 branches missed.">                for (Container container : ev.getGrid()[column][row])</span>
                {
<span class="nc bnc" id="L80" title="All 2 branches missed.">                    while (readyForNextContainer)</span>
                    try
                    {
<span class="nc bnc" id="L83" title="All 2 branches missed.">                        if (container != null)</span>
                        {
<span class="nc" id="L85">                            readyForNextContainer = false;</span>
                            //ask agv!
<span class="nc" id="L87">                            super.load(ev.unload(container));</span>
                            
<span class="nc" id="L89">                            this.loadTime = (Math.abs(this.position.y-container.getArrivalPosition().y) / this.moveContainerSpeed //move gripper to position of container</span>
                            //+ this.dropTimeMin + (this.dropTimeMax - this.dropTimeMin) / ((int)container.getArrivalPosition().z + 1) //droptime depended on z position of container //???
                            + this.SECURETIME
                            + this.liftTimeMin + (this.liftTimeMax - this.liftTimeMin) / ((int)container.getArrivalPosition().z + 1) //lifttime depended on z position of container
                            + Math.abs(this.position.y-container.getArrivalPosition().y) / this.moveContainerSpeed) * 100;
<span class="nc" id="L94">                            this.status = Status.LOADING;</span>
                            
<span class="nc" id="L96">                            this.unloadTime = (this.dropTimeMin + (this.dropTimeMax - this.dropTimeMin) / ((int)container.getArrivalPosition().z + 1) + this.SECURETIME) * 100;</span>
                            
                             
                        }
                    }
<span class="nc" id="L101">                    catch(Exception e)</span>
                    {
<span class="nc" id="L103">                        throw e;</span>
<span class="nc" id="L104">                    }</span>
                    
                }
            
       
<span class="nc" id="L109">        }</span>
        
<span class="nc" id="L111">        this.isAvailable = true;</span>
<span class="nc" id="L112">    }</span>
    
    

    
    public void load(Container container) throws VehicleOverflowException, CargoOutOfBoundsException{ //container from extern verhicle
        try
        {
<span class="nc" id="L120">            super.load(container);</span>
<span class="nc" id="L121">            this.loadTime = (Math.abs(this.position.y-container.getArrivalPosition().y) / this.moveContainerSpeed //move gripper to position of container</span>
                            //+ this.dropTimeMin + (this.dropTimeMax - this.dropTimeMin) / ((int)container.getArrivalPosition().z + 1) //droptime depended on z position of container
                            + this.SECURETIME
                            + this.liftTimeMin + (this.liftTimeMax - this.liftTimeMin) / ((int)container.getArrivalPosition().z + 1) //lifttime depended on z position of container
                            + Math.abs(this.position.y-container.getArrivalPosition().y) / this.moveContainerSpeed) * 100;
            
<span class="nc" id="L127">            this.status = Status.LOADING;</span>
            
<span class="nc" id="L129">            this.unloadTime = (this.dropTimeMin + (this.dropTimeMax - this.dropTimeMin) / ((int)container.getArrivalPosition().z + 1) + this.SECURETIME) * 100;</span>
        }
<span class="nc" id="L131">        catch(Exception e)</span>
        {
<span class="nc" id="L133">            throw e;</span>
<span class="nc" id="L134">        }</span>

        //this.timeCountDown = (int) liftTimeMax;
        //update: while (this.timeCounter &lt; starttime + liftTimeMax + moveContainerSpeed * 2){} //aan het laden
        //roep evt nieuwe agv aan (op zelfde parkeerplaats of op parkeerplaats opzij [moet platform doen]
<span class="nc" id="L139">    }</span>
    
    
    
    public void move(int direction) //-1 is left 1 is right
    {
        
        //override this method for truckcrane
<span class="nc" id="L147">        List&lt;Vector3f&gt; route = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L148">        route.add(this.position);</span>
<span class="nc bnc" id="L149" title="All 2 branches missed.">        if (direction == -1)</span>
        {
<span class="nc" id="L151">            route.add(new Vector3f(this.position.x - Container.depth, this.position.y, this.position.z));</span>
        }
        
        else 
        {
<span class="nc" id="L156">            route.add(new Vector3f(this.position.x + Container.depth, this.position.y, this.position.z));</span>
        }
        
<span class="nc bnc" id="L159" title="All 2 branches missed.">        this.currentSpeed = (this.isLoaded) ? this.maxSpeedLoaded : this.maxSpeedUnloaded;</span>
<span class="nc" id="L160">        HashMap&lt;String, Object&gt; map = new HashMap&lt;&gt;();</span>
<span class="nc" id="L161">        map.put(&quot;id&quot;, this.getID());</span>
<span class="nc" id="L162">        map.put(&quot;vehicleType&quot;, this.getVehicleType());</span>
<span class="nc" id="L163">        map.put(&quot;motionPath&quot;, route); </span>
<span class="nc" id="L164">        map.put(&quot;speed&quot;, currentSpeed);</span>
        
<span class="nc" id="L166">        this.route = new Route(route,Road.getPathLength(route));</span>
            
<span class="nc" id="L168">        CommandHandler.addCommand(new Command(&quot;moveCrane&quot;, map));</span>
<span class="nc" id="L169">    }</span>

    @Override
    public void update()
    {
<span class="nc" id="L174">       super.update();</span>
<span class="nc bnc" id="L175" title="All 2 branches missed.">       if (this.status == Status.LOADING )</span>
       {
<span class="nc" id="L177">           this.loadTime--;</span>
<span class="nc bnc" id="L178" title="All 2 branches missed.">           if (this.loadTime &lt;= 0)</span>
           { 
<span class="nc" id="L180">               this.status = Status.UNLOADING;</span>
        
               
               //command simulator
           }
           
       }
       
<span class="nc bnc" id="L188" title="All 4 branches missed.">       if (this.status == Status.UNLOADING &amp;&amp; this.agvToUnload != null)</span>
       {
<span class="nc" id="L190">           this.unloadTime--;</span>
<span class="nc bnc" id="L191" title="All 2 branches missed.">           if (this.unloadTime &lt;= 0)</span>
           {
               try
               {
<span class="nc" id="L195">                this.unload(agvToUnload);</span>
               }
<span class="nc" id="L197">               catch(Exception e){ System.out.println(e.getMessage()); }</span>
<span class="nc" id="L198">               this.agvToUnload = null;</span>
<span class="nc" id="L199">               this.currentPlatform.getAGV(this.getPosition());</span>
<span class="nc" id="L200">               this.status = Status.WAITING;</span>
<span class="nc" id="L201">               readyForNextContainer = true;</span>
               //new load
           }
       }
       
<span class="nc" id="L206">    }</span>
    
<span class="nc" id="L208">    public void setAGV(AGV agv){ this.agvToUnload = agv; }</span>
    

 
    

    
    
    
    //methode opzij in subclasses waarvoor geldig is
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.3.201306030806</span></div></body></html>