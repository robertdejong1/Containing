<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="nl"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>Controlleralgorithms.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JaCoCoverage analysis of project &quot;Containing&quot; (powered by JaCoCo from EclEmma)</a> &gt; <a href="index.html" class="el_package">containing</a> &gt; <span class="el_source">Controlleralgorithms.java</span></div><h1>Controlleralgorithms.java</h1><pre class="source lang-java linenums">package containing;

import static containing.Container.TransportType.Barge;
import static containing.Container.TransportType.Seaship;
import static containing.Container.TransportType.Train;
import static containing.Container.TransportType.Truck;
import containing.Exceptions.CargoOutOfBoundsException;
import containing.Exceptions.NoJobException;
import containing.Exceptions.VehicleOverflowException;
import containing.Platform.Platform;
import containing.Vehicle.Barge;
import containing.Vehicle.ExternVehicle;
import containing.Vehicle.Seaship;
import containing.Vehicle.Train;
import containing.Vehicle.Truck;
import containing.Vehicle.Vehicle;
import java.sql.Timestamp;
import java.util.ArrayList;
import java.util.Date;
import java.util.List;
import java.util.Stack;
import java.util.Calendar;

<span class="nc" id="L24">class Controlleralgorithms </span>
{
    private static List&lt;Job&gt; jobQeueUnsorted;
    private static Stack&lt;Job&gt; jobQeueSorted;
    private static List&lt;ExternVehicle&gt; scheduledArrivingVehicles;
    
    public static void sortInCommingContainers(List&lt;Container&gt; ContainersFromXML)
    {
<span class="nc" id="L32">        scheduledArrivingVehicles = new ArrayList&lt;&gt;();</span>
        
<span class="nc bnc" id="L34" title="All 2 branches missed.">        if (ContainersFromXML != null)</span>
        {
<span class="nc" id="L36">            Settings.messageLog.AddMessage(&quot;Created &quot; + ContainersFromXML.size() + &quot; Containers from xml file&quot;);</span>
            
            //Sort Containers into Vehicles
<span class="nc bnc" id="L39" title="All 2 branches missed.">            for (int i = 0; i &lt; ContainersFromXML.size(); i++)</span>
            {
<span class="nc" id="L41">                Date ArrivalDateContainer = ContainersFromXML.get(i).getArrivalDate();</span>
<span class="nc" id="L42">                float ArrivalTimeFromContainer = ContainersFromXML.get(i).getArrivalTimeFrom();</span>
<span class="nc" id="L43">                Vehicle VehicleWithMatchingDateAndTime = null;</span>
                
                //Search List of arriving vehicles for a match on arrivalDate &amp; time
<span class="nc bnc" id="L46" title="All 2 branches missed.">                for (int j = 0; j &lt; scheduledArrivingVehicles.size(); j++)</span>
                {
<span class="nc bnc" id="L48" title="All 4 branches missed.">                    if (</span>
                            (scheduledArrivingVehicles.get(j).getArrivalDate().equals(ArrivalDateContainer))
                            &amp;&amp; 
                            (scheduledArrivingVehicles.get(j).getArrivalTime() == ArrivalTimeFromContainer)
                        )
                    {
<span class="nc" id="L54">                        VehicleWithMatchingDateAndTime = scheduledArrivingVehicles.get(j);</span>
<span class="nc" id="L55">                        break;</span>
                    }
                }
            
                //Add container to the matching vehicle or create a new vehicle
<span class="nc bnc" id="L60" title="All 2 branches missed.">                if (VehicleWithMatchingDateAndTime != null)</span>
                {
                    //Catch error if vehicle happens to be full
                    try
                    {
<span class="nc" id="L65">                        VehicleWithMatchingDateAndTime.load(ContainersFromXML.get(i));</span>
                    }
<span class="nc" id="L67">                    catch (Exception e)</span>
                    {
                        
<span class="nc" id="L70">                        ErrorLog.logMsg(VehicleWithMatchingDateAndTime.getVehicleType() + &quot; has no room for this container.&quot;, e);</span>
<span class="nc" id="L71">                    }</span>
                }
                else
                {
<span class="nc" id="L75">                    ExternVehicle NewVehicle = createNewVehicle(</span>
                            ContainersFromXML.get(i).getArrivalTransport(), 
                            ContainersFromXML.get(i).getArrivalDate(), 
                            ContainersFromXML.get(i).getArrivalTimeFrom(),
                            ContainersFromXML.get(i).getArrivalTransportCompany());
                    
<span class="nc" id="L81">                    Settings.messageLog.AddMessage(&quot;Created new &quot; + ContainersFromXML.get(i).getArrivalTransport()); // : &quot; + VehicleWithMatchingDateAndTime.toString());</span>
                    try
                    {
<span class="nc" id="L84">                        NewVehicle.load(ContainersFromXML.get(i));</span>
                    }
<span class="nc" id="L86">                    catch (CargoOutOfBoundsException | VehicleOverflowException e)</span>
                    {
                        //isvoor later
<span class="nc" id="L89">                    }</span>
                    
<span class="nc" id="L91">                    scheduledArrivingVehicles.add(NewVehicle);</span>
                }
                
            }
            
            try
            {
<span class="nc" id="L98">                Settings.userInterface.StartSimulationButton.setEnabled(true);</span>
            }
<span class="nc" id="L100">            catch (NullPointerException E)</span>
            {
                //voor test
<span class="nc" id="L103">            }            </span>
        }
        else
        {
<span class="nc" id="L107">            Settings.messageLog.AddMessage(&quot;File is emtpy or not a valid xml file&quot;);</span>
        }
        
<span class="nc" id="L110">    }</span>
    
    /*
     * Search if job exists with same timestamp
     * true? add container to job
     * false? create new job
     * Sort List of jobs
     */
    public static void sortOutgoingContainer(Container UnloadedContainer)
    {
<span class="nc" id="L120">        boolean SuitingJobFound = false;</span>
        
<span class="nc bnc" id="L122" title="All 2 branches missed.">        if (jobQeueUnsorted == null)</span>
        {
<span class="nc" id="L124">            jobQeueUnsorted = new ArrayList&lt;&gt;();</span>
        }
        
<span class="nc bnc" id="L127" title="All 2 branches missed.">        for (Job j : jobQeueUnsorted)</span>
        {
<span class="nc bnc" id="L129" title="All 6 branches missed.">            if (j.getDate().equals(UnloadedContainer.getDepartureDate())</span>
                    &amp;&amp;
                j.getVehicleType().equals(UnloadedContainer.getDepartureTransport())
                    &amp;&amp;
                createNewVehicle(
                    j.getVehicleType(), 
                    UnloadedContainer.getDepartureDate(),
                    UnloadedContainer.getDepartureTimeFrom(), 
                    UnloadedContainer.getArrivalTransportCompany()).getCapicity() &gt; j.getContainers().size()
                )
            {
<span class="nc" id="L140">                SuitingJobFound = true;</span>
<span class="nc" id="L141">                j.addContainer(UnloadedContainer);</span>
<span class="nc" id="L142">                break;</span>
            }
<span class="nc" id="L144">        }</span>
        
<span class="nc bnc" id="L146" title="All 2 branches missed.">        if (!SuitingJobFound)</span>
        {   
<span class="nc" id="L148">            Job job = new Job(</span>
                    UnloadedContainer.getDepartureDate(), 
                    UnloadedContainer.getDepartureTimeFrom(), 
                    UnloadedContainer.getDepartureTransport(),
                    UnloadedContainer.getArrivalTransportCompany());
<span class="nc" id="L153">            job.addContainer(UnloadedContainer);</span>
            
<span class="nc" id="L155">            jobQeueUnsorted.add(job);</span>
        }
        
<span class="nc" id="L158">        jobQeueSorted = Job.sortOutGoingJobs(jobQeueUnsorted);</span>
<span class="nc" id="L159">    }</span>
    
   /*
    *Removes job from the JobQeue
    *Checks if there is already a docked vehicle waiting
    *if not create a new vehicle
    *return job
    */ 
    public static Job getNextJob(Platform platform, Timestamp timeStamp) throws NoJobException
    {
<span class="nc" id="L169">        Job job = null;</span>
        
        //Create date and time from timestamp
<span class="nc" id="L172">        Calendar calendar = Calendar.getInstance();</span>
<span class="nc" id="L173">        calendar.setTime(timeStamp);</span>
        
<span class="nc" id="L175">        Date date = new Date(calendar.getTime().getYear(), calendar.getTime().getMonth(), calendar.getTime().getDate());</span>
<span class="nc" id="L176">        float departureTime = timeStamp.getHours() + ((float)timeStamp.getMinutes() / 100);</span>
        
        //Get job and remove from qeue
        try
        {
<span class="nc" id="L181">            job = jobQeueSorted.pop();</span>
        }
<span class="nc" id="L183">        catch (Exception e)//OOPS hou geen rekening met verschillende types platformen</span>
        {
<span class="nc" id="L185">            throw new NoJobException(&quot;No jobs in qeue.&quot;);</span>
<span class="nc" id="L186">        }</span>
        
<span class="nc bnc" id="L188" title="All 8 branches missed.">        if (</span>
                job.getVehicleType() == platform.getTransportType()
                &amp;&amp;
                (
                    job.getDate().equals(date) || job.getDate().before(date)
                )
                &amp;&amp;
                (
                    job.getDepartureTime() &lt;= departureTime
                )
            )
        {
<span class="nc" id="L200">            jobQeueUnsorted.remove(job);</span>
            
            //Check platform for empty parkingspot:
<span class="nc bnc" id="L203" title="All 2 branches missed.">            if (platform.hasFreeParkingSpot())</span>
            {
<span class="nc" id="L205">                ExternVehicle eV = createNewVehicle(</span>
                        job.getVehicleType(), 
                        job.getDate(), 
                        job.getDepartureTime(), 
                        job.getCompanyName());
                
<span class="nc" id="L211">                job.setTargetVehicle(eV);</span>
<span class="nc" id="L212">            }</span>
            else
            {
                //job.changeContainerDepartureTime(job.getDepartureTime());
<span class="nc" id="L216">                jobQeueSorted.push(job);</span>
<span class="nc" id="L217">                jobQeueUnsorted.add(job);</span>
            
<span class="nc" id="L219">                job = null;</span>
<span class="nc" id="L220">                throw new NoJobException(&quot;No job available&quot;);</span>
            }
        
<span class="nc" id="L223">            return job;</span>
        }
        else
        {
<span class="nc" id="L227">            jobQeueSorted.push(job);</span>
<span class="nc" id="L228">            throw new NoJobException(&quot;No jobs for platform.&quot;);</span>
        }
        
    }
    
    //Creates vehicle based on type
    private static ExternVehicle createNewVehicle(Container.TransportType typeofVehicle, Date date, float time, String companyName)
    {
<span class="nc" id="L236">        ExternVehicle vehicleToReturn = null;</span>
        
<span class="nc bnc" id="L238" title="All 5 branches missed.">        switch (typeofVehicle)</span>
        {
            case Truck:
<span class="nc" id="L241">                vehicleToReturn = new Truck(date, time, matchTransportTypeWithPlatform(typeofVehicle), companyName);</span>
<span class="nc" id="L242">                break;</span>
            case Train:
<span class="nc" id="L244">                vehicleToReturn = new Train(date, time , matchTransportTypeWithPlatform(typeofVehicle), companyName);</span>
<span class="nc" id="L245">                break;    </span>
            case Barge:
<span class="nc" id="L247">                vehicleToReturn = new Barge(date, time, matchTransportTypeWithPlatform(typeofVehicle), companyName);</span>
<span class="nc" id="L248">                break;</span>
            case Seaship:
<span class="nc" id="L250">                vehicleToReturn = new Seaship(date, time, matchTransportTypeWithPlatform(typeofVehicle), companyName);</span>
<span class="nc" id="L251">                break;</span>
        }
        
<span class="nc" id="L254">        return vehicleToReturn;</span>
    }
    
    //Check list for matching vehicles
    public static void checkIncomingVehicles(Timestamp timeStamp)
    {
        //System.out.println(timeStamp);
<span class="nc" id="L261">        Calendar calendar = Calendar.getInstance();</span>
<span class="nc" id="L262">        calendar.setTime(timeStamp);</span>
        
<span class="nc" id="L264">        Date date = new Date(calendar.getTime().getYear(), calendar.getTime().getMonth(), calendar.getTime().getDate());</span>
<span class="nc" id="L265">        float arrivalTime = timeStamp.getHours() + ((float)timeStamp.getMinutes() / 100);</span>
        
<span class="nc bnc" id="L267" title="All 2 branches missed.">        for (ExternVehicle ev : scheduledArrivingVehicles)</span>
        {       
<span class="nc bnc" id="L269" title="All 6 branches missed.">            if (</span>
                    (date.equals(ev.getArrivalDate()) &amp;&amp; (arrivalTime == ev.getArrivalTime()))
                    &amp;&amp;
                    (ev.getCurrentPlatform().hasFreeParkingSpot())
                ) 
            {
<span class="nc" id="L275">                ev.enter();</span>
<span class="nc" id="L276">                Settings.messageLog.AddMessage(ev.toString() + &quot; is entering.&quot;);</span>
<span class="nc" id="L277">                scheduledArrivingVehicles.remove(ev);</span>
<span class="nc" id="L278">                break;</span>
                //ik doe nog niks met het feit dat er geen parkingspots kunnen zijn
            }
<span class="nc" id="L281">        }</span>
<span class="nc" id="L282">    }</span>
    
    private static Platform matchTransportTypeWithPlatform(Container.TransportType transportType)
    {
<span class="nc" id="L286">        Platform platform = null;</span>
        
<span class="nc bnc" id="L288" title="All 2 branches missed.">        for (Platform p : Settings.port.getPlatforms())</span>
        {
<span class="nc bnc" id="L290" title="All 2 branches missed.">            if (p.getTransportType() == transportType)</span>
            {
<span class="nc" id="L292">                platform = p;</span>
            }
<span class="nc" id="L294">        }</span>
        
<span class="nc" id="L296">        return platform;</span>
    }
    
    public static long getFirstDate(List&lt;Container&gt; ContainersFromXML)
    {
<span class="nc bnc" id="L301" title="All 2 branches missed.">        if (ContainersFromXML.size() &gt; 0)</span>
        {
<span class="nc" id="L303">            Container FirstContainer = ContainersFromXML.get(0);</span>
        
<span class="nc bnc" id="L305" title="All 2 branches missed.">            for (Container c : ContainersFromXML)</span>
            {
<span class="nc bnc" id="L307" title="All 8 branches missed.">                if ((c.getArrivalDate().before(FirstContainer.getArrivalDate())</span>
                        &amp;&amp;
                   (c.getArrivalTimeFrom() &lt;= FirstContainer.getArrivalTimeFrom()))
                        ||
                   ((c.getArrivalDate().equals(FirstContainer.getArrivalDate())
                        &amp;&amp;
                   (c.getArrivalTimeFrom() &lt;= FirstContainer.getArrivalTimeFrom()))
                        
                   ))
                {
<span class="nc" id="L317">                    FirstContainer = c;</span>
               }
<span class="nc" id="L319">            }</span>
            
<span class="nc" id="L321">            int hours = (int)FirstContainer.getArrivalTimeFrom();</span>
<span class="nc" id="L322">            float minutes = ((float)FirstContainer.getArrivalTimeFrom() % 1) * 100;</span>
            
<span class="nc" id="L324">            Date date = new Date(FirstContainer.getArrivalDate().getYear(), FirstContainer.getArrivalDate().getMonth(), FirstContainer.getArrivalDate().getDate(), hours, (int)minutes);</span>
<span class="nc" id="L325">            return date.getTime();</span>
        }
        else
        {
<span class="nc" id="L329">            return(1102806000000l);</span>
        }
    }

    public static List&lt;ExternVehicle&gt; getScheduledArrivingVehicles() 
    {
<span class="nc" id="L335">        return scheduledArrivingVehicles;</span>
    }

    public static Stack&lt;Job&gt; getJobQeueSorted() 
    {
<span class="nc" id="L340">        return jobQeueSorted;</span>
    }

    public static List&lt;Job&gt; getJobQeueUnsorted() 
    {
<span class="nc" id="L345">        return jobQeueUnsorted;</span>
    }
    
    public static void ClearLists()
    {
<span class="nc" id="L350">        jobQeueUnsorted.clear();</span>
<span class="nc" id="L351">        jobQeueSorted.clear();</span>
<span class="nc" id="L352">        scheduledArrivingVehicles.clear();</span>
<span class="nc" id="L353">    }</span>
    
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.3.201306030806</span></div></body></html>